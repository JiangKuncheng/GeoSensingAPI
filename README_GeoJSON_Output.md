# GeoJSON输出功能说明

## 概述

修改后的API测试脚本现在能够自动将返回的GeoJSON数据保存到本地文件中，方便您导入专业GIS软件（如QGIS、ArcGIS等）进行查看和分析。

## 功能特点

### 📁 自动文件管理
- 自动创建 `api_test_output` 文件夹
- 为每个API创建独立的子文件夹
- 文件名包含地名和时间戳，避免重复

### 🗂️ 文件组织结构
```
api_test_output/
├── 计算面积/
│   ├── 武汉市_20250703_125555.geojson
│   ├── 湖北省_20250703_125555.geojson
│   └── ...
├── 计算质心/
│   ├── 武汉市_20250703_125558.geojson
│   └── ...
├── 计算缓冲区/
│   └── ...
└── ...
```

### 📊 支持的数据类型
- **FeatureCollection**: 完整的GeoJSON要素集合
- **Feature**: 单个GeoJSON要素
- **Point**: 点几何（如质心）
- **Polygon**: 面几何（如缓冲区、凸包）
- **LineString**: 线几何（如边界）

## 使用方法

### 1. 运行测试脚本
```bash
python comprehensive_api_test.py
```

### 2. 查看输出结果
测试完成后，您会看到类似以下的输出：
```
📁 保存的GeoJSON文件:
   武汉市: api_test_output\计算缓冲区\武汉市_20250703_125555.geojson
   湖北省: api_test_output\计算缓冲区\湖北省_20250703_125555.geojson
```

### 3. 导入专业软件
将生成的 `.geojson` 文件直接拖拽到以下软件中：
- **QGIS**: 支持直接导入GeoJSON文件
- **ArcGIS**: 支持GeoJSON格式
- **Google Earth**: 可以导入GeoJSON文件
- **在线地图工具**: 如 geojson.io

## 文件命名规则

文件名格式：`{地名}_{时间戳}.geojson`

- **地名**: 原始输入的地名（如：武汉市、湖北省）
- **时间戳**: 格式为 `YYYYMMDD_HHMMSS`
- **扩展名**: `.geojson`

示例：`武汉市_20250703_125555.geojson`

## 支持的API类型

### 🎯 几何运算API
- 计算面积
- 计算边界
- 计算边界框
- 计算缓冲区
- 计算质心
- 矩形裁剪
- 凹壳计算
- 凸壳计算
- 计算包络线
- 计算长度
- 最小包围半径
- 简化几何
- 总边界框

### 🔄 几何变换API
- 几何旋转
- 几何缩放
- 几何平移
- 几何反转
- 线合并
- 移除重复点

### 🔗 空间关系API
- 包含关系检查
- 相交关系检查
- 距离计算
- 等等...

## 测试报告

测试完成后会生成两个报告文件：

### 1. 详细报告 (`api_test_report.json`)
包含完整的测试结果，包括：
- 测试时间
- 成功/失败统计
- 每个API的详细结果
- 保存的文件路径

### 2. 摘要报告 (`api_test_summary.txt`)
包含简洁的测试摘要，包括：
- 测试统计信息
- 每个API的状态
- 保存的文件列表

## 注意事项

1. **文件大小**: 某些操作（如缓冲区）可能生成较大的文件
2. **坐标系**: 所有坐标都使用WGS84坐标系
3. **编码**: 文件使用UTF-8编码，支持中文字符
4. **重复运行**: 每次运行都会生成新的文件，不会覆盖旧文件

## 故障排除

### 问题：文件保存失败
**可能原因**: 权限不足或磁盘空间不足
**解决方案**: 检查文件夹权限和磁盘空间

### 问题：文件为空
**可能原因**: API返回null结果
**解决方案**: 检查API实现和输入数据

### 问题：文件名包含特殊字符
**解决方案**: 脚本会自动清理文件名，移除特殊字符

## 示例用法

```python
# 运行测试
python comprehensive_api_test.py

# 查看生成的文件
ls api_test_output/

# 在QGIS中打开文件
# 1. 启动QGIS
# 2. 拖拽 .geojson 文件到地图窗口
# 3. 文件会自动加载并显示
```

## 技术支持

如果您在使用过程中遇到问题，请检查：
1. API服务是否正常运行
2. 输入数据是否正确
3. 输出目录是否有写入权限
4. 磁盘空间是否充足 